# Progress - Redesign Cycle (Onze Voordelen & Over Ons)

## Milestones
- [x] Update all environment files
- [x] Next.js 16 Upgrade
- [x] **Vercel deployment successful** ✅
- [x] **Relevance-Based Search Implementation** (2026-01-23) ✅
  - [x] Designed relevance scoring (title > summary > content)
  - [x] Implemented `/api/search` with server-side scoring
  - [x] Added scope filtering (all/title/summary/content)
  - [x] Updated UI with scope filter buttons
- [x] **Diensten Page Layout Refresh** (2026-01-23) ✅
  - [x] Implemented alternating section layouts
  - [x] Added visual methodology timeline (`ProcessTimeline`)
  - [x] Transformed lists into Bento Grid style
  - [x] Added ScrollReveal entrance animations
  - [x] Enhanced expertise grid and premium footer CTA
- [x] **Onze Voordelen Page Redesign** (2026-01-23) ✅
  - [x] Created new `OnzeVoordelenContent.tsx` component
  - [x] Applied same styling patterns as DienstenContent
  - [x] Added 5 advantage cards with custom SVG icons
  - [x] Implemented stats section and quote block
  - [x] Added ScrollReveal animations throughout
- [x] **Over Ons Page Spectacular Redesign** (2026-01-23) ✅
  - [x] Created new `OverOnsContent.tsx` with spectacular visual effects
  - [x] Implemented Parallax Hero and directional ScrollReveal
  - [x] Interactive expertise cards with expandable information
  - [x] Modern story and floating values layout
- [x] **SEO & Redirect Integrity** (2026-01-25)
  - [x] Check WWW vs non-WWW redirects
  - [x] Identify canonical domain version
  - [x] Implement permanent redirect to non-WWW
- [x] **JSON-LD Structured Data Improvements** (2026-01-25)
  - [x] Updated to ProfessionalService schema with stable @id (`#professionalservice`)
  - [x] Standardized on non-WWW URLs (`https://maasiso.nl`)
  - [x] Integrated real contact details (Tel, Email)
  - [x] Implemented BlogPosting and BreadcrumbList for blog posts
  - [x] Extended SchemaMarkup component
- [x] **Author Page Creation** (/over-niels-maas) (2026-01-25) ✅
- [x] **Internal Linking & Author ID Verification** (2026-01-25) ✅
- [x] **Final Domain Unification Check (non-WWW)** (2026-01-25) ✅
- [x] **Automated Verification Script** (2026-01-25) ✅
- [x] **Final Repository Sync & SEO/Sitemap Implementation** (2026-01-25) ✅

- [x] **Project Metadata Analysis** (2026-01-25) ✅
  - [x] Identified root `app/` as active directory
  - [x] Audited `app/layout.tsx` for metadataBase
  - [x] Checked `next.config.js` for trailingSlash
  - [x] Audited dynamic and static routes for canonical tags
- [x] **Canonical Tags Implementation** (2026-01-25) ✅
  - [x] Set `metadataBase` to `https://maasiso.nl` in root layout
  - [x] Added default canonical tag in `app/layout.tsx`
  - [x] Implemented canonical tags for all static pages
  - [x] Implemented canonical tags for dynamic routes (`blog/[slug]`, `news/[slug]`)
  - [x] Verified non-WWW and no trailing slash consistency
- [x] **Claude Code Installation** (2026-01-26) ✅
  - [x] Installed Claude Code v2.1.19
  - [x] Configured User PATH environment variable
- [x] **SEO/GEO Enhancement - Database Migration** (2026-01-26) ✅
  - [x] Created SQL migration script with all required tables
  - [x] Created Node.js runner script for migration execution
  - [x] Successfully migrated Railway PostgreSQL database
  - [x] New tables: `authors`, `components_blog_tldr_items`, `components_blog_faq_items`
  - [x] `/api/authors` endpoint now returns 200
- [x] **SEO/GEO Enhancement - Author Data Migration** (2026-01-26) ✅
  - [x] Created [`scripts/migrate-authors.js`](scripts/migrate-authors.js:1)
  - [x] Updated all 36 blog posts with Author="Niels Maas"
- [x] **SEO/GEO Enhancement - Strapi Content-Type Schema** (2026-01-26) ✅
  - [x] Update Strapi content-type schema in `maasiso-strapi-railway` repository
  - [x] Push changes to GitHub to trigger Railway redeploy
- [x] **SEO/GEO Enhancement - Full Author Relation** (2026-01-26) ✅
  - [x] Create author entries via Strapi Admin UI (Niels Maas created)
  - [x] Update blog posts to use author relation instead of string
  - [x] All 36 blog posts linked to author
- [x] **SEO/GEO Enhancement - Phase 2 COMPLETE** (2026-01-26) ✅
  - [x] Author content type deployed to production
  - [x] TL;DR and FAQ components added to blog-post schema
  - [x] Production API verified working
  - [x] Railway connected to GitHub for automatic deployments
- [x] **relatedPosts ValidationError Fix - Initial** (2026-01-27) ✅
  - [x] Identified root cause: circular `mappedBy: "relatedPosts"` in Strapi v5 self-referencing manyToMany
  - [x] Removed `mappedBy` attribute from blog-post schema for unidirectional relation
  - [x] ValidationError in Admin UI persists - deeper Strapi v5 bug identified
- [x] **relatedPosts Self-Referencing Bug - SOLVED WITH DATABASE WORKAROUND** (2026-01-27) ✅
  - [x] Created diagnostic script [`scripts/link-related-posts.js`](scripts/link-related-posts.js:1)
  - [x] Tested 5 different API payload formats - all fail to save relation
  - [x] Root cause: Strapi v5 bug with self-referencing manyToMany relations
  - [x] Admin UI error: `Document with id "...", locale "null" not found`
  - [x] API accepts requests but silently fails to persist the relation
  - [x] Changed schema to bidirectional (`relatedPosts` + `relatedFrom`) - Admin UI still fails
  - [x] Commit `6c716e9` pushed to Railway
  - [x] **FINAL SOLUTION**: Created [`scripts/direct-link-related-posts.js`](scripts/direct-link-related-posts.js:1)
  - [x] Direct database script bypasses Admin UI and writes to PostgreSQL join table
  - [x] **TEST SUCCESS**: Linked "avg-beeldmateriaal-toestemming" (ID: 30) → "checklist-iso-14001" (ID: 41)
- [x] **relatedPosts Frontend Display - FULLY WORKING** (2026-01-27) ✅
 - [x] **AuthorBox Business Card Redesign** (2026-01-27) ✅
  - [x] Fixed API: Added explicit populate for relatedPosts in [`src/lib/api.ts`](src/lib/api.ts:953)
  - [x] Fixed Types: Added `RelatedPost` type to [`src/lib/types.ts`](src/lib/types.ts:157)
  - [x] Fixed Mapping: `mapRelatedPosts` now handles both Strapi v4 and v5 structures
  - [x] Fixed Sidebar: [`BlogPostContent.tsx`](src/components/features/BlogPostContent.tsx:34) now uses actual `post.relatedPosts`
  - [x] Created user-friendly tools: Desktop shortcut, batch file, interactive script, README
  - [x] **VERIFIED**: relatedPosts display correctly in both bottom section AND sidebar

## Recent Changes
- COMPLETED: AuthorBox redesigned as professional business card with author image, bio, expertise tags, and action buttons in [`src/components/features/AuthorBox.tsx`](src/components/features/AuthorBox.tsx).
- COMPLETED: Updated `mapAuthor()` to support Strapi v4 and v5 author structures in [`src/lib/api.ts`](src/lib/api.ts:181).
- COMPLETED: Direct database workaround for relatedPosts - script successfully links posts via PostgreSQL (2026-01-27).
- COMPLETED: Added inspect-by-slug option to [`scripts/link-gerelateerde-posts.js`](scripts/link-gerelateerde-posts.js:1) to show relatedPosts + relatedFrom (2026-01-27).
- COMPLETED: relatedPosts bidirectional workaround implemented - schema now has `relatedPosts` (inversedBy) + `relatedFrom` (mappedBy) (2026-01-27).
- COMPLETED: Created [`scripts/link-related-posts.js`](scripts/link-related-posts.js:1) diagnostic tool (2026-01-27).
- COMPLETED: relatedPosts ValidationError partially fixed by removing circular `mappedBy` from blog-post schema (2026-01-27).
- COMPLETED: TL;DR block moved to render under "Terug naar Blog" in [`BlogPostContent.tsx`](src/components/features/BlogPostContent.tsx:71).
- COMPLETED: Markdown bold rendering enabled for TL;DR and FAQ via utilities in [`TldrBlock.tsx`](src/components/features/TldrBlock.tsx:15) and [`FaqSection.tsx`](src/components/features/FaqSection.tsx:15).
- COMPLETED: Build passed; changes pushed in commit `3d5dba8`.
- COMPLETED: Repositioned TL;DR block to render between the featured image and the intro content in [`BlogPostContent.tsx`](src/components/features/BlogPostContent.tsx:103).
- MILESTONE: SEO/GEO Enhancement Phase 2 COMPLETE (2026-01-26)
- COMPLETED: Author "Niels Maas" created with full bio, credentials, 12 expertise areas
- COMPLETED: All 36 blog posts linked to author relation
- COMPLETED: TL;DR component schema deployed and working
- COMPLETED: FAQ component schema deployed and ready
- COMPLETED: Production API verification passed - all endpoints working
- COMPLETED: Database migration executed successfully against Railway PostgreSQL.
- COMPLETED: Created and ran author migration script - all 36 blog posts updated.
- COMPLETED: Installed Claude Code 2.1.19 and configured environment variables for global access.
- COMPLETED: Deployed latest changes to Git repository, including sitemap normalization, verification scripts, and removal of test pages.
- COMPLETED: Added 301 redirects for `/contact.html` and `/blog/iso-27001-checklist` to remove "crawled not indexed" noise.
- COMPLETED: Added 7 301 redirects for legacy `/diensten/...` URLs to their new service pages (incl. `/diensten/iso-45001`).
- COMPLETED: Added permanent redirects for `/index.html` → `/` and `/algemene-voorwaarden` → `/terms-and-conditions` in [`src/middleware.ts`](src/middleware.ts).
- COMPLETED: Configured `/$` to return a real `404` response (no redirect) via middleware.
- COMPLETED: Created `/iso-45001` placeholder landing (indexable) with canonical metadata, Dutch intro, and contact CTA.
- COMPLETED: Included `/iso-45001` in the sitemap static routes and excluded it from dynamic slugs.
- COMPLETED: Sitemap URL formatting fix (trim base/path, enforce single `/`, remove `/home` from sitemap, paginate Strapi content for completeness).
- COMPLETED: Canonical Tags Implementation - all static and dynamic routes now have proper canonical tags.
- COMPLETED: Implemented `metadataBase` and default canonical tag in `app/layout.tsx`.
- COMPLETED: Added explicit canonical tags to all static service, blog, news, and information pages.
- COMPLETED: Verified non-WWW and non-trailing-slash consistency across all metadata.
- COMPLETED: Analyzed project structure for metadata and canonical tag implementation.
- COMPLETED: Created and ran `scripts/verify-entities.js` to automate canonical and JSON-LD validation.
- COMPLETED: Pushed all SEO, JSON-LD, Author Page, and Canonical Tag changes to the remote repository.
- COMPLETED: Final sweep for `www.maasiso.nl` in `app/` and `src/`. Confirmed 0 occurrences in source.
- COMPLETED: Strengthened internal linking by adding "Over Niels Maas" section to the Over Ons page.
- COMPLETED: Verified and unified author `@id` in blog post schema across the site.
- COMPLETED: Created /over-niels-maas author page with biography, expertise, and publications.
- COMPLETED: Improved JSON-LD structured data with ProfessionalService ID and Blog schemas.
- COMPLETED: Checked WWW vs non-WWW redirects. Found that both secure variants return 200 OK.
- COMPLETED: Implemented WWW to non-WWW redirect in `next.config.js` and deployed to Git.
- NEW: `src/components/features/OverOnsContent.tsx` - Spectacular redesign of the "Over Ons" page.
- MODIFIED: `app/over-ons/page.tsx` - Updated to use the new OverOnsContent component.
- NEW: `src/components/features/OnzeVoordelenContent.tsx` - Complete redesign of the Onze Voordelen page with modern styling matching DienstenContent.
- MODIFIED: `app/onze-voordelen/page.tsx` - Simplified to use the new OnzeVoordelenContent component.
- DESIGNED: Added 5 custom SVG icons to `src/components/features/DienstenContent.tsx` representing each expertise area (Quality, Security, Privacy, Environment, Info Management).
- REFINED: `src/components/features/DienstenContent.tsx` - Polished the expertise grid to be "strak" and corporate, using the MaasISO huisstijl colors and premium typography.
- REFACTORED: `src/components/features/DienstenContent.tsx` - Changed expertise explorer to a modern responsive grid.
- IMPROVED: Parsing logic for expertise items to handle complex content structures.
- MODIFIED: `app/diensten/page.tsx` - Full dynamic redesign
- MODIFIED: `src/app/globals.css` - Animation styles
- NEW: `src/lib/utils/searchScoring.ts` - Scoring logic
- NEW: `app/api/search/route.ts` - API endpoint
- MODIFIED: `src/components/features/SearchFilters.tsx` - Scope UI

## Impact
- Meest relevante resultaten komen nu eerst bij het zoeken.
- De dienstenpagina voelt veel professioneler en minder repetitief door de dynamische layouts en animaties.
- De werkwijze van MaasISO is nu visueel en makkelijk te begrijpen.
